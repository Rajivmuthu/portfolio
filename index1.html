<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="./server.js"></script>
    <link rel="stylesheet" href="./style1.css">
</head>
<body>
    <form id="my-form" >
        <div class="row mb-4">
          <div class="col-lg-12 col-md-12 col-sm-12 ">
            <input type="text" class="form-control fname-margin" style="display:none;"  id="id" placeholder="id" >
          </div>
          
          <div class="col-lg-6 col-md-6 col-sm-12 ">
            <input type="text" class="form-control fname-margin"  id="name" placeholder="First name *" >
          </div>
          <div class="col-lg-6 col-md-6 col-sm-12">
            <input type="email" class="form-control" id="email" placeholder="Email *" >
          </div>
        </div>
        <input type="text" class="form-control mb-3" id="subject" placeholder="Subject *" >
    
        <textarea class="form-control mb-5" id="textarea" placeholder="Leave a Message here *"></textarea>
    
        <div class="mx-auto d-flex justify-content-center mb-4 ">
         
        <button onclick="store()" id="btn" type="button"  class="btn btn-primary sub-button" >ADD</button>
        <button onclick="updates()" id="update" type="button"  class="btn btn-primary sub-button">UPDATE</button>

      </div>
        </div>
      </form>

      <table id="Mytable">
        <thead >
          <tr>
            <th scope="col">Id</th>
            <th scope="col">First_Name</th>
            <th scope="col">Email</th>
            <th scope="col">Subject</th>
            <th scope="col">Message</th>
            <th scope="col">Edit/Delete</th>
          </tr>
        </thead>
        <tbody id="table-body">
          
        </tbody>
      </table>




        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
<script>
//         window.onload = getAll();

// let btn = document.getElementById('btn');

// let form = document.getElementById('my-form');






// btn.addEventListener("click",()=>{
//  submitButton();
//  form.reset();

// });

        function store(){

            console.log('clicked', document.getElementById("name").value);
                  fetch('http://localhost:5000/insertall', {
               method: 'POST',
               body: JSON.stringify({
                  Cname: document.getElementById("name").value,
                  email: document.getElementById("email").value,
                  subjects: document.getElementById("subject").value,
                  message: document.getElementById("textarea").value,
            }),
            headers: {
              'Content-type': 'application/json; charset=UTF-8',
            },
          })
            .then((response) => response.json())
            .then((json) => console.log(json));
            // getAll();
        }


</script>
<script>

        // function getall(){
          fetch('http://localhost:5000/')
        .then(res => res.json())
        .then(users => {
            console.log(users)
            html=""
        users.forEach(element => {
            html+=`<tr>
                <td>${element.id}</td>
                <td> ${element.Cname}</td>
                <td>${element.email}</td>
                <td>${element.subjects}</td>
                <td>${element.message}</td>
                <td><button onclick="edit(${element.id},'${element.Cname}','${element.email}','${element.subjects}','${element.message}')">Edit</button><button>Delete</button></td>
                
                </<tr>`
        });
        console.log(html)
        // document.getElementsByTagName("table-body").innerHTML=html
        document.getElementById("Mytable").innerHTML=html
    
    })
        // }
        


        

        //       const nameInput = document.getElementById('name');
        //     const emailInput = document.getElementById('email');
        //     const subjectInput = document.getElementById('subject');
        //     const messageInput = document.getElementById('textarea');
        //     const form = document.getElementById('my-form');
          
        //     form.addEventListener('ADD', (event) => {
          
        //       // Validate name field
        //       const nameValue = nameInput.value.trim();
        //       const nameRegex = /^[a-zA-Z ]+$/;
          
        //       if (nameValue.length === 0) {
        //     alert('Please enter your name');
        //     event.preventDefault();
        //     return;
        //   }
        //       if (!nameValue.match(nameRegex)) {
        //         alert('Please enter only alphabets in the name field');
        //         event.preventDefault();
        //         return;
        //       }
          
             
          
        //     // Validate email field
        //     const emailValue = emailInput.value.trim();
        //     const emailRegex = /^[a-z0-9._-]+@[a-z0-9.-]+\.[a-z]{2,3}$/; //syntax for mail
          
        //     if (emailValue.length === 0) {
        //     alert('Please enter your Email');
        //     event.preventDefault();
        //     return;
        //   }
          
        //     if (!emailValue.match(emailRegex)) {
        //       alert('Please enter a valid email address');
        //       event.preventDefault();
        //       return;
        //     }
          
        //     // Validate subject field
        //     const subjectValue = subjectInput.value.trim();
          
        //     if (subjectValue.length === 0) {
        //     alert('Please Enter the Subject');
        //     event.preventDefault();
        //     return;
        //   }
          
        //     if (!subjectValue.match(nameRegex)) {
        //       alert('Please enter only alphabets in the subject field');
        //       event.preventDefault();
        //       return;
        //     }
        //     //validate message field
        //     const messageValue = messageInput.value.trim();
        //     const messageRegex = /^[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/? ]+$/;
        //     if (messageValue.length === 0) {
        //       alert('Please enter a message');
        //       event.preventDefault();
        //       return;
        //     }
          
        //     // If all fields are valid, submit the form
        //   });
          </script> 
          <script>
            function updates(){

console.log('clicked', document.getElementById("name").value);
      fetch('http://localhost:5000/update',
       {
   method: 'PUT',
   body: JSON.stringify({
      id:document.getElementById('id').value,
      Cname: document.getElementById("name").value,
      email: document.getElementById("email").value,
      subjects: document.getElementById("subject").value,
      message: document.getElementById("textarea").value,
}),
headers: {
  'Content-type': 'application/json; charset=UTF-8',
},
})
.then((response) => response.json())
.then((json) => console.log(json));
}
          </script>
          <script>
            fetch('http://localhost:5000/id')
        .then(res => res.json())
        .then(users => {
            console.log(users)
            html=""
        users.forEach(element => {
            html+=`edit()`
        });
        console.log(html)
        // document.getElementsByTagName("tbody")[0].innerHTML=html
        document.getElementById("Mytable").innerHTML=html
    
    })
          </script>
          <script>
            function edit(id,Cname,email,subjects,message)
            {
              document.getElementById('id').value=id;
              document.getElementById('name').value=Cname;
              document.getElementById('email').value=email;
              document.getElementById('subject').value=subjects;
              document.getElementById('textarea').value=message;
            }
          </script>
</body>
</html>